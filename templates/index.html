<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Processor</title>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            text-align: center; 
            max-width: 600px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0px 4px 30px rgba(0, 0, 0, 0.2);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
        }

        .drop-area {
            border: 2px dashed rgba(255, 255, 255, 0.6);
            border-radius: 8px;
            padding: 3rem;
            text-align: center;
            margin-bottom: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .drop-area:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #fff;
        }

        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            color: #000;
            width: 90%;
            max-width: 400px;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .popup .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .option {
            background: rgba(37, 99, 235, 0.1);
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease, background 0.2s ease;
        }

        .option:hover {
            background: rgba(37, 99, 235, 0.2);
            transform: translateY(-5px);
        }

        .spinner {
            display: none;
            margin-top: 1rem;
        }

        .success {
            display: none;
            margin-top: 1rem;
        }

        .preview {
            margin-top: 1rem;
            display: none;
        }

        .button {
            background: #2563eb;
            color: #fff;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: bold;
            text-decoration: none;
            transition: all 0.3s ease;
            display: inline-block;
            margin-top: 1rem;
        }

        .button:hover {
            background: #1d4ed8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Image Processor</h1>
        <div class="drop-area" id="dropArea">
            <p><i class="fas fa-upload"></i></p>
            <p>Drag and drop your image here or click to select</p>
            <input type="file" id="fileInput" hidden accept="image/*">
        </div>
        <div class="popup" id="popup">
            <h2>Select an Operation</h2>
            <div class="options">
                <div class="option" id="removeBg-fast">
                    <i class="fas fa-eraser"></i>
                    <p>Remove Background fast</p>
                </div>
                <div class="option" id="removeBg-precise">
                    <i class="fas fa-eraser"></i>
                    <p>Remove Background precise</p>
                </div>
                <div class="option" id="expandImage">
                    <i class="fas fa-expand-alt"></i>
                    <p>Content-Aware Expand</p>
                </div>
                <div class="option" id="expandColor">
                    <i class="fas fa-fill-drip"></i>
                    <p>Color Expand</p>
                </div>
            </div>
        </div>
        <div class="spinner" id="spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Processing...</p>
        </div>
        <div class="preview" id="preview">
            <img src="" alt="Processed Image" id="previewImg" style="max-width:300px; border-radius: 8px;">
        </div>
        <div class="success" id="success">
            <p>Operation completed! Download your image below:</p>
            <a href="#" class="button" id="downloadBtn">Download Image</a>
        </div>
    </div>

    <script>
        // DOM Elements
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('fileInput');
        const popup = document.getElementById('popup');
        const spinner = document.getElementById('spinner');
        const success = document.getElementById('success');
        const preview = document.getElementById('preview');
        const previewImg = document.getElementById('previewImg');
        const downloadBtn = document.getElementById('downloadBtn');
    
        let selectedFile = null;
    
        // Drag-and-Drop Handlers
        dropArea.addEventListener('click', () => fileInput.click());
    
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.style.background = 'rgba(255, 255, 255, 0.1)';
        });
    
        dropArea.addEventListener('dragleave', () => {
            dropArea.style.background = 'transparent';
        });
    
        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.style.background = 'transparent';
            const files = e.dataTransfer.files;
            handleFiles(files);
        });
    
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));
    
        // Handle File Selection
        function handleFiles(files) {
            if (files.length > 0) {
                selectedFile = files[0];
                if (validateImage(selectedFile)) {
                    popup.style.display = 'block';
                } else {
                    alert('Please upload a valid image file.');
                }
            }
        }
    
        // Validate Uploaded File
        function validateImage(file) {
            const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                console.error('Invalid file type:', file.type);
                return false;
            }
            return true;
        }
    
        // Process Image with Selected Operation
        async function processImage(action) {
            if (!selectedFile) {
                alert('No file selected. Please upload an image first.');
                return;
            }
    
            const formData = new FormData();
            formData.append('image', selectedFile);
            formData.append('operation', action);
    
            popup.style.display = 'none';
            spinner.style.display = 'block';
    
            try {
                const response = await fetch('/process', {
                    method: 'POST',
                    body: formData,
                });
    
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Processing failed.');
                }
    
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
    
                // Show the result
                spinner.style.display = 'none';
                preview.style.display = 'block';
                previewImg.src = url;
    
                success.style.display = 'block';
                downloadBtn.href = url;
                downloadBtn.download = 'processed-image.png';
            } catch (error) {
                console.error('Error during image processing:', error);
                alert(`Something went wrong: ${error.message}`);
                spinner.style.display = 'none';
            }
        }
    
        // Attach Event Listeners for Operation Buttons
        document.getElementById('removeBg-fast').addEventListener('click', () => processImage('remove_bg_fast'));
        document.getElementById('removeBg-precise').addEventListener('click', () => processImage('remove_bg_precise'));
        document.getElementById('expandImage').addEventListener('click', () => processImage('expand_image'));
        document.getElementById('expandColor').addEventListener('click', () => processImage('expand_color'));
    </script>
</body>
</html>